"""
Run All Penetration Tests
Executa todos os testes de seguranÃ§a e gera relatÃ³rio
"""
import asyncio
from pathlib import Path

from core.security.pentest_framework import PenetrationTestFramework


async def main():
    """
    Executa todos os testes de penetraÃ§Ã£o
    """
    print("\n" + "=" * 80)
    print("ðŸ§ª OpenCngsm v3.3 - Penetration Testing")
    print("=" * 80)
    print()
    
    # Criar framework
    framework = PenetrationTestFramework()
    
    # Executar todos os testes
    print("ðŸ”„ Executando testes de seguranÃ§a...")
    print()
    
    suite = await framework.run_all_tests()
    
    # Gerar relatÃ³rios
    print("\n" + "=" * 80)
    print("ðŸ“Š Gerando relatÃ³rios...")
    print("=" * 80)
    print()
    
    # RelatÃ³rio em texto
    framework.generate_report(suite)
    
    # RelatÃ³rio em JSON
    framework.generate_json_report(suite)
    
    # EstatÃ­sticas
    stats = suite.get_stats()
    success_rate = suite.success_rate()
    
    print("\n" + "=" * 80)
    print("ðŸ“ˆ RESUMO FINAL")
    print("=" * 80)
    print()
    print(f"Total de testes: {stats['total']}")
    print(f"âœ… Passou: {stats['passed']}")
    print(f"âŒ Falhou: {stats['failed']}")
    print(f"â­ï¸ Pulado: {stats['skipped']}")
    print(f"âš ï¸ Erro: {stats['error']}")
    print()
    print(f"Taxa de sucesso: {success_rate:.1f}%")
    print()
    
    # ConclusÃ£o
    if success_rate >= 95:
        print("âœ… EXCELENTE: Postura de seguranÃ§a forte!")
    elif success_rate >= 80:
        print("âš ï¸ BOM: SeguranÃ§a aceitÃ¡vel, mas precisa melhorias")
    elif success_rate >= 60:
        print("âš ï¸ ATENÃ‡ÃƒO: SeguranÃ§a tem lacunas significativas")
    else:
        print("âŒ CRÃTICO: SeguranÃ§a inadequada!")
    
    print()
    print("=" * 80)
    print()
    
    # Retornar cÃ³digo de saÃ­da
    return 0 if success_rate >= 95 else 1


if __name__ == "__main__":
    exit_code = asyncio.run(main())
    exit(exit_code)
